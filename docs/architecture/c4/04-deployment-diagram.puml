@startuml WhatsApp Dashboard - Deployment
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Deployment.puml

LAYOUT_WITH_LEGEND()

title Diagrama de Deployment - Docker Compose

Deployment_Node(dev_machine, "Máquina de Desenvolvimento", "Linux/Mac/Windows") {
    Deployment_Node(docker, "Docker Engine", "Docker 24+") {
        Deployment_Node(docker_network, "Docker Network: whatsapp_network") {
            
            Deployment_Node(frontend_container, "Container: frontend", "Node 18") {
                Container(frontend, "Frontend", "React + Vite", "Porta 5173")
            }
            
            Deployment_Node(backend_container, "Container: backend", "Python 3.11") {
                Container(backend, "Backend API", "Django + Gunicorn", "Porta 8000")
            }
            
            Deployment_Node(celery_worker_container, "Container: celery-worker", "Python 3.11") {
                Container(worker, "Celery Worker", "Celery", "Processa tasks")
            }
            
            Deployment_Node(celery_beat_container, "Container: celery-beat", "Python 3.11") {
                Container(beat, "Celery Beat", "Celery", "Scheduler")
            }
            
            Deployment_Node(postgres_container, "Container: postgres", "PostgreSQL 15") {
                ContainerDb(postgres, "PostgreSQL", "Database", "Porta 5432")
            }
            
            Deployment_Node(redis_container, "Container: redis", "Redis 7") {
                ContainerDb(redis, "Redis", "Broker", "Porta 6379")
            }
            
            Deployment_Node(evolution_container, "Container: evolution-api", "Node 18") {
                Container(evolution, "Evolution API", "v2.1.1", "Porta 8080")
            }
        }
    }
}

' Volumes
Deployment_Node(volumes, "Docker Volumes") {
    ContainerDb(postgres_data, "postgres_data", "Volume", "Dados persistentes")
    ContainerDb(redis_data, "redis_data", "Volume", "Cache persistente")
    ContainerDb(evolution_data, "evolution_instances", "Volume", "Instâncias WhatsApp")
}

' Relacionamentos
Rel(frontend, backend, "HTTP", "Port 8000")
Rel(backend, postgres, "SQL", "Port 5432")
Rel(backend, redis, "Redis Protocol", "Port 6379")
Rel(worker, redis, "Redis Protocol", "Port 6379")
Rel(beat, redis, "Redis Protocol", "Port 6379")
Rel(backend, evolution, "HTTP", "Port 8080")
Rel(postgres, postgres_data, "Persiste")
Rel(redis, redis_data, "Persiste")
Rel(evolution, evolution_data, "Persiste")

SHOW_LEGEND()
@enduml